<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ll-date-picker/ll-date-picker.html">

<script src="../moment/min/moment.min.js"></script>
<!--
A clickable, read-only text input that launches ll-date-picker to set its value (for display) and its custom data-iso attribute.

Example:

    <ll-date-input></ll-date-input>

A clickable, read-only text input that launches ll-date-picker to set its display and iso values.
@demo
-->
<script>

  LLDateInput = Polymer({

    is: 'll-date-input',

    extends: 'input',

    properties: {

      dataIso: {
        type: String,
        notify: true,
        reflectToAttribute: true,
        observer: '_isoChanged'
      },

      /**
       * The one instance of ll-date-picker created by this or another ll-date-input instance.
       */
      _datePicker: Object

    },

    created: function () {
      this.readOnly = true;
    },

    /**
     * Create one instance of ll-date-picker and attach to document body.
     * Does not create one if another ll-date-input has already done so.
     */
    attached: function () {
      this._datePicker = document.getElementById('llDatePicker');
      if (!this._datePicker) {
        this._datePicker = new LLDatePicker();
        document.body.appendChild(this._datePicker);
      }
    },

    listeners: {
      'tap': '_tap'
    },

    /**
     * Called by ll-date-picker after user clicks dialog confirmation button.
     *
     * @param data {object} Contains display and iso strings. display string not used currently.
     */
    datePicked: function (data) {
      this.dataIso = data.iso;
    },

    _tap: function () {
      this._datePicker.open(this, this._isoToDisplay(this.dataIso));
    },

    _isoChanged: function (newVal) {
      this.value = this._isoToDisplay(newVal);
    },

    /**
     * Converts iso date string like '18:30:22' and converts to '6:30 PM'
     *
     * @param isoStr {string}
     * @returns {string}
     * @private
     */
    _isoToDisplay: function (isoStr) {
      var m = moment(isoStr, 'HH:mm:ss');
      if (m.isValid()) {
        return m.format('h:mm A');
      }
    }

  });

</script>
