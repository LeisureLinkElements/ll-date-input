<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../ll-time-picker/ll-time-picker.html">

<script src="../moment/min/moment.min.js"></script>
<!--
An extended input element that uses an external ll-date-picker instance to set its display and ISO values.

Example:

    <ll-time-input></ll-time-input>

A clickable, read-only text input that launches ll-time-picker to set its display and iso values.
-->
<script>

  LLTimeInput = Polymer({

    is: 'll-time-input',

    extends: 'input',

    properties: {

      dataIso: {
        type: String,
        notify: true,
        reflectToAttribute: true,
        observer: '_isoChanged'
      },

      _timePicker: Object

    },

    created: function () {
      this.readOnly = true;
    },

    attached: function () {
      this._timePicker = document.getElementById('llTimePicker');
      if (!this._timePicker) {
        this._timePicker = new LLTimePicker();
        document.body.appendChild(this._timePicker);
      }
    },

    listeners: {
      'tap': '_tap'
    },

    timePicked: function (data) {
      this.dataIso = data.iso;
    },

    _tap: function () {
      this._timePicker.open(this, this._isoToDisplay(this.dataIso));
    },

    _isoChanged: function (newVal, oldVal) {
      this.value = this._isoToDisplay(newVal);
    },

    _isoToDisplay: function (isoStr) {
      var m = moment(isoStr, 'HH:mm:ss');
      if (m.isValid()) {
        return m.format('h:mm A');
      }
    }

  });

</script>
